<UserControl
	x:Class="RemoteLogViewer.WPF.Views.Settings.HighlightSettingsPage"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:views="clr-namespace:RemoteLogViewer.WPF.Views.Settings"
	xmlns:highlight="clr-namespace:RemoteLogViewer.Core.ViewModels.Settings.Highlight;assembly=RemoteLogViewer.Core"
	mc:Ignorable="d">
	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="260" />
			<ColumnDefinition Width="*" />
		</Grid.ColumnDefinitions>
		<Grid.RowDefinitions>
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>
		<StackPanel Grid.Column="0" Grid.Row="0">
			<TextBlock Text="Highlight Settings" FontWeight="SemiBold" FontSize="14" />
			<StackPanel Orientation="Horizontal">
				<Button Content="Add Setting" Command="{Binding AddRuleCommand}"/>
				<Button Content="Remove" Command="{Binding RemoveRuleCommand}" CommandParameter="{Binding SelectedRule.Value, Mode=TwoWay}"/>
			</StackPanel>
			<ListView ItemsSource="{Binding Rules}" SelectedItem="{Binding SelectedRule.Value, Mode=TwoWay}">
				<ListView.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Name.Value, Mode=OneWay}"/>
					</DataTemplate>
				</ListView.ItemTemplate>
			</ListView>
		</StackPanel>
		<Grid Grid.Column="1" Grid.Row="0" Visibility="{Binding SelectedRule.Value,Mode=OneWay,Converter={StaticResource NullToVisibilityConverter}}">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>
			<StackPanel Orientation="Horizontal" Grid.Row="0">
				<TextBlock Text="Setting Name" VerticalAlignment="Center" />
				<TextBox Width="240" Text="{Binding SelectedRule.Value.Name.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
			</StackPanel>
			<StackPanel Grid.Row="1">
				<TextBlock Text="Highlight Conditions" FontWeight="SemiBold" />
				<Button Content="Add Condition" Width="140" Command="{Binding SelectedRule.Value.AddConditionCommand,Mode=OneWay}"/>
				<Button Content="Remove Condition" HorizontalAlignment="Left" Command="{Binding SelectedRule.Value.RemoveConditionCommand,Mode=OneWay}" CommandParameter="{Binding SelectedRule.Value.SelectedCondition.Value,Mode=OneWay}"/>
				<ListBox Height="240" ItemsSource="{Binding SelectedRule.Value.Conditions,Mode=OneWay}" SelectedItem="{Binding ViewModel.SelectedRule.Value.SelectedCondition.Value,Mode=TwoWay}">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding Pattern.Value, Mode=OneWay}" />
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
				<Border BorderBrush="Gray" BorderThickness="1" CornerRadius="4" Padding="8" Margin="0,0,0,8" Visibility="{Binding SelectedRule.Value.SelectedCondition.Value,Mode=OneWay,Converter={StaticResource NullToVisibilityConverter}}">
					<StackPanel>
						<StackPanel Orientation="Horizontal">
							<TextBlock Text="Pattern" Width="60" VerticalAlignment="Center" />
							<TextBox Width="240" Text="{Binding SelectedRule.Value.SelectedCondition.Value.Pattern.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
						</StackPanel>
						<StackPanel Orientation="Horizontal">
							<TextBlock Text="Type" Width="60" VerticalAlignment="Center" />
							<ComboBox Width="160" ItemsSource="{Binding PatternTypes}" SelectedItem="{Binding SelectedRule.Value.SelectedCondition.Value.PatternType.Value, Mode=TwoWay}">
								<ComboBox.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding Converter={StaticResource HighlightPatternTypeToStringConverter}}" />
									</DataTemplate>
								</ComboBox.ItemTemplate>
							</ComboBox>
							<CheckBox Content="Ignore Case" IsChecked="{Binding SelectedRule.Value.SelectedCondition.Value.IgnoreCase.Value, Mode=TwoWay}"/>
							<CheckBox Content="Only Match" IsChecked="{Binding SelectedRule.Value.SelectedCondition.Value.HighlightOnlyMatch.Value, Mode=TwoWay}" />
						</StackPanel>
						<StackPanel Orientation="Horizontal">
							<TextBlock Text="Fore" Width="60" VerticalAlignment="Center" />
							<Button
								Width="80"
								Click="ForeColorButton_Click">
								<Button.Content>
									<Grid RowDefinitions="Auto,8">
										<TextBlock>Change</TextBlock>
										<Rectangle
											Grid.Row="1"
											RadiusX="4"
											RadiusY="4"
											HorizontalAlignment="Stretch"
											Visibility="{Binding SelectedRule.Value.SelectedCondition.Value.IsForeColorSet.Value, Mode=OneWay,Converter={StaticResource BooleanToVisibilityConverter}}">
											<Rectangle.Fill>
												<SolidColorBrush Color="{Binding SelectedRule.Value.SelectedCondition.Value.ForeColor.Value, Mode=OneWay, Converter={StaticResource ColorModelToColorConverter}}" />
											</Rectangle.Fill>
										</Rectangle>
										<Rectangle
											Grid.Row="1"
											Stroke="Black"
											StrokeThickness="1"
											StrokeDashArray="2,2"
											RadiusX="4"
											RadiusY="4"
											Fill="Transparent"
											HorizontalAlignment="Stretch"
											Visibility="{Binding SelectedRule.Value.SelectedCondition.Value.IsForeColorSet.Value, Mode=OneWay,Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
										<Popup x:Name="ForeColorPopup"
											PlacementTarget="{Binding ElementName=ColorButton}"
											StaysOpen="False">
											<TextBox Text="{Binding SelectedRule.Value.SelectedCondition.Value.ForeColor.Value, Mode=TwoWay, Converter={StaticResource ColorModelToColorConverter}}" />
										</Popup>
									</Grid>
								</Button.Content>
							</Button>
							<Button Command="{Binding SelectedRule.Value.SelectedCondition.Value.ClearForeColorCommand, Mode=OneWay}">
								<TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8E6;"/>
							</Button>
							<TextBlock Text="Back" Width="60" VerticalAlignment="Center" />
							<Button
								Width="80"
								Click="BackColorButton_Click">
								<Button.Content>
									<Grid RowDefinitions="Auto,8">
										<TextBlock>Change</TextBlock>
										<Rectangle
											Grid.Row="1"
											RadiusX="4"
											RadiusY="4"
											HorizontalAlignment="Stretch"
											Visibility="{Binding SelectedRule.Value.SelectedCondition.Value.IsBackColorSet.Value, Mode=OneWay,Converter={StaticResource BooleanToVisibilityConverter}}">
											<Rectangle.Fill>
												<SolidColorBrush Color="{Binding SelectedRule.Value.SelectedCondition.Value.BackColor.Value, Mode=OneWay, Converter={StaticResource ColorModelToColorConverter}}" />
											</Rectangle.Fill>
										</Rectangle>
										<Rectangle
											Grid.Row="1"
											Stroke="Black"
											StrokeThickness="1"
											StrokeDashArray="2,2"
											RadiusX="4"
											RadiusY="4"
											Fill="Transparent"
											HorizontalAlignment="Stretch"
											Visibility="{Binding SelectedRule.Value.SelectedCondition.Value.IsBackColorSet.Value, Mode=OneWay,Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
										<Popup x:Name="BackColorPopup"
										   PlacementTarget="{Binding ElementName=ColorButton}"
										   StaysOpen="False">
											<TextBox Text="{Binding SelectedRule.Value.SelectedCondition.Value.BackColor.Value, Mode=TwoWay, Converter={StaticResource ColorModelToColorConverter}}"/>
										</Popup>
									</Grid>
								</Button.Content>
							</Button>
							<Button Command="{Binding SelectedRule.Value.SelectedCondition.Value.ClearBackColorCommand, Mode=OneWay}">
								<TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8E6;"/>
							</Button>
						</StackPanel>
					</StackPanel>
				</Border>
			</StackPanel>
		</Grid>
	</Grid>
</UserControl>