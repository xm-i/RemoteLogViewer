<Page
	x:Class="RemoteLogViewer.WPF.Views.Ssh.SshServerSelectorPage"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:sshVm="clr-namespace:RemoteLogViewer.Core.ViewModels.Ssh"
	mc:Ignorable="d">
	<Grid Padding="16">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="240"/>
			<ColumnDefinition Width="*"/>
		</Grid.ColumnDefinitions>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<!-- Left list -->
		<StackPanel Spacing="8" Margin="0,0,0,8">
			<TextBlock Text="Saved Connections" FontWeight="SemiBold"/>
			<Button Content="+" Width="40"
          Command="{Binding AddSavedConnectionsCommand, Mode=OneWay}"/>
		</StackPanel>

		<ListBox Grid.Row="1" Margin="0,0,12,0"
			ItemsSource="{Binding SavedConnections}"
			MouseDoubleClick="SavedConnections_MouseDoubleClick"
			SelectionChanged="SavedConnections_SelectionChanged"
			SelectedItem="{Binding SelectedSshConnectionInfo.Value}">
			<ListBox.ItemTemplate>
				<DataTemplate DataType="{x:Type sshVm:SshConnectionInfoViewModel}">
					<TextBlock Text="{Binding DisplayName.Value}"/>
				</DataTemplate>
			</ListBox.ItemTemplate>
		</ListBox>

		<!-- Right form -->
		<ScrollViewer
			Grid.Column="1"
			Grid.RowSpan="2"
			Margin="8,0,0,0"
			VerticalScrollBarVisibility="Auto">
			<StackPanel Visibility="{Binding SelectedSshConnectionInfo.Value, Converter={StaticResource NullToVisibilityConverter}}">
				<TextBlock Text="Connection Settings" FontWeight="SemiBold" Margin="0,0,0,4"/>

				<TextBox Text="{Binding SelectedSshConnectionInfo.Value.Name.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4"/>

				<!-- Host + Port -->
				<Grid Margin="0,0,0,4">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="3*"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>
					<TextBox Grid.Column="0" Margin="0,0,12,0"
                         Text="{Binding SelectedSshConnectionInfo.Value.Host.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
					<TextBox Grid.Column="1"
                         Text="{Binding SelectedSshConnectionInfo.Value.Port.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
				</Grid>

				<!-- User + Password -->
				<Grid Margin="0,0,0,4">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>
					<TextBox Grid.Column="0" Margin="0,0,12,0"
                         Text="{Binding SelectedSshConnectionInfo.Value.User.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
					<PasswordBox Grid.Column="1" x:Name="PasswordBox" Password="{Binding SelectedSshConnectionInfo.Value.Password.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
				</Grid>

				<!-- Private Key Path + Browse -->
				<Grid Margin="0,0,0,4">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>
					<TextBox Grid.Column="0" Margin="0,0,12,0"
                         Text="{Binding SelectedSshConnectionInfo.Value.PrivateKeyPath.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
					<Button Grid.Column="1" Content="..." Width="44"
                        Click="BrowsePrivateKeyButton_Click"/>
				</Grid>

				<PasswordBox x:Name="PrivateKeyPassphraseBox" Margin="0,0,0,4" Password="{Binding SelectedSshConnectionInfo.Value.PrivateKeyPassphrase.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

				<!-- Encoding -->
				<Grid Margin="0,0,0,4">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="2*"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>
					<ComboBox Grid.Column="0" Margin="0,0,12,0"
                          ItemsSource="{Binding AvailableEncodings}"
                          SelectedValue="{Binding SelectedSshConnectionInfo.Value.EncodingString.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
				</Grid>

				<!-- Buttons -->
				<StackPanel Orientation="Horizontal" Margin="0,4,0,0">
					<Button Content="Test" Command="{Binding TestConnectCommand}"
                        IsEnabled="{Binding SelectedSshConnectionInfo.Value.IsEdited.Value, Converter={StaticResource BooleanNegationConverter}}"/>
					<Button Content="Connect" Command="{Binding ConnectCommand}"
                        IsEnabled="{Binding SelectedSshConnectionInfo.Value.IsEdited.Value, Converter={StaticResource BooleanNegationConverter}}"/>
					<Button Content="Save" Command="{Binding SelectedSshConnectionInfo.Value.SaveConnectionInfoCommand}"/>
					<Button Content="Remove" Command="{Binding SelectedSshConnectionInfo.Value.RemoveConnectionInfoCommand}"/>
				</StackPanel>
			</StackPanel>
		</ScrollViewer>
	</Grid>
</Page>